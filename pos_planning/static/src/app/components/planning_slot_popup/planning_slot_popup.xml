<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">
    <t t-name="pos_planning.PlanningSlotPopup">
        <Dialog title="title" size="'lg'">
            <div class="container-fluid bg-100 p-0">
                <div class="row g-0 h-100">
                    <!-- Left Sidebar: Basic Info -->
                    <div class="col-md-4 border-end bg-white">
                        <div class="p-4 d-flex flex-column gap-4 h-100">
                            <!-- Service Selection -->
                            <div>
                                <div
                                    class="d-flex align-items-center justify-content-between mb-2"
                                >
                                    <div
                                        class="d-flex align-items-center text-uppercase text-muted small fw-bold"
                                    >
                                        <i
                                            class="fa fa-cutlery me-2"
                                        /> Service / Product
                                    </div>
                                    <h6
                                        class="mb-0 text-primary fw-bold"
                                        t-esc="filteredProducts.length"
                                    />
                                </div>
                                <div class="input-group input-group-sm shadow-sm">
                                    <input
                                        type="text"
                                        class="form-control border-0 bg-light"
                                        placeholder="Search Services..."
                                        t-model="state.productSearchTerm"
                                        t-on-keydown="(ev) => this.onProductSearchKeydown(ev)"
                                        autofocus="autofocus"
                                    />
                                </div>
                            </div>

                            <!-- Resource & Location -->
                            <div>
                                <div class="mb-3">
                                    <div class="mb-2">
                                        <label
                                            class="form-label small fw-bold text-muted text-uppercase"
                                        ><i
                                                class="fa fa-user me-2"
                                            /> Assigned Resource</label>
                                        <select
                                            class="form-select border-0 bg-light shadow-sm"
                                            t-model="state.resource_id"
                                        >
                                            <option value="">-- Unassigned --</option>
                                            <option
                                                t-foreach="props.resources"
                                                t-as="r"
                                                t-key="r.id"
                                                t-att-value="r.id"
                                                t-esc="r.name"
                                            />
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Content: Date & Customer -->
                    <div class="col-md-8 bg-white">
                        <div class="p-4">
                            <!-- Customer & Autofill -->
                            <div class="card mb-4 border-0 shadow-sm">
                                <div class="card-body p-3 bg-white rounded-3">
                                    <label
                                        class="form-label small fw-bold text-muted text-uppercase mb-2"
                                    ><i
                                            class="fa fa-user-plus me-1"
                                        /> Customer Search and Autofill</label>
                                    <div class="row g-2 mb-2">
                                        <div class="col-md-7">
                                            <div
                                                class="input-group input-group-sm shadow-sm border rounded-3 overflow-hidden"
                                            >
                                                <span
                                                    class="input-group-text border-0 bg-white"
                                                ><i
                                                        class="fa fa-search text-muted small"
                                                    /></span>
                                                <input
                                                    type="text"
                                                    class="form-control border-0 ps-0 shadow-none"
                                                    placeholder="Search/Create Customer Name..."
                                                    t-att-value="state.partnerSearchTerm"
                                                    t-on-input="(ev) => this.onPartnerSearchInput(ev)"
                                                    t-on-keydown="(ev) => this.onPartnerSearchKeyDown(ev)"
                                                />
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div
                                                class="input-group input-group-sm shadow-sm border rounded-3 overflow-hidden"
                                            >
                                                <span
                                                    class="input-group-text border-0 bg-white"
                                                ><i
                                                        class="fa fa-phone text-muted small"
                                                    /></span>
                                                <input
                                                    type="text"
                                                    class="form-control border-0 ps-0 shadow-none"
                                                    t-att-value="state.phone"
                                                    t-on-input="(ev) => this.onPhoneInput(ev)"
                                                    placeholder="Phone..."
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div
                                        t-if="state.showPartnerList"
                                        class="list-group shadow-sm mb-3 border rounded-3 overflow-auto position-relative"
                                        style="max-height: 200px; z-index: 100;"
                                    >
                                        <t
                                            t-foreach="filteredPartners"
                                            t-as="p"
                                            t-key="p.id"
                                        >
                                            <button
                                                type="button"
                                                class="list-group-item list-group-item-action d-flex justify-content-between align-items-center p-2 border-0 border-bottom"
                                                t-on-mousedown.stop="() => this.selectPartner(p)"
                                            >
                                                <span
                                                    class="fw-bold text-dark"
                                                ><t t-esc="p.name" /></span>
                                                <small
                                                    class="text-muted"
                                                ><i
                                                        class="fa fa-phone me-1"
                                                    /> <t
                                                        t-esc="p.phone"
                                                    /></small>
                                            </button>
                                        </t>
                                        <button
                                            type="button"
                                            class="list-group-item list-group-item-action p-2 bg-light text-center small text-muted border-0"
                                            t-on-mousedown.stop="() => { this.state.partner_id = 0; this.state.showPartnerList = false; }"
                                        >
                                            <i
                                                class="fa fa-plus-circle me-1"
                                            /> Create "<t
                                                t-esc="state.partnerSearchTerm"
                                            />" <t
                                                t-if="state.phone"
                                            >with phone <t
                                                    t-esc="state.phone"
                                                /></t>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Date & Time -->
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label
                                        class="form-label small fw-bold text-muted text-uppercase"
                                    ><i
                                            class="fa fa-clock-o me-2"
                                        /> Start Time</label>
                                    <input
                                        type="datetime-local"
                                        class="form-control bg-light border-0 shadow-sm"
                                        t-model="state.start_datetime"
                                        t-on-change="(ev) => this.onStartChange(ev)"
                                    />
                                </div>
                                <div class="col-md-6">
                                    <label
                                        class="form-label small fw-bold text-muted text-uppercase"
                                    ><i
                                            class="fa fa-clock-o me-2"
                                        /> End Time</label>
                                    <div class="input-group shadow-sm">
                                        <span
                                            class="input-group-text border-0 bg-white text-muted"
                                        ><i class="fa fa-hourglass-end" /></span>
                                        <input
                                            type="datetime-local"
                                            class="form-control border-0 bg-light"
                                            t-model="state.end_datetime"
                                        />
                                    </div>
                                </div>
                            </div>

                            <!-- Selected Services Tags -->
                            <div class="mb-4">
                                <label
                                    class="form-label small fw-bold text-muted text-uppercase mb-2"
                                ><i
                                        class="fa fa-tags me-2"
                                    /> Booking Items</label>
                                <div class="d-flex flex-wrap gap-2">
                                    <t
                                        t-foreach="state.booking_line_ids"
                                        t-as="lineId"
                                        t-key="lineId"
                                    >
                                        <button
                                            class="btn btn-outline-primary btn-sm rounded-pill d-flex align-items-center gap-2 ps-3 pe-2 shadow-sm border-0 bg-light text-dark"
                                            t-on-click="() => this.removeProduct(lineId)"
                                        >
                                            <div
                                                class="d-flex flex-column text-start lh-1"
                                            >
                                                <span
                                                    class="fw-bold"
                                                    style="font-size: 0.9em;"
                                                ><t
                                                        t-esc="getProduct(lineId).display_name"
                                                    /></span>
                                                <span
                                                    class="text-muted"
                                                    style="font-size: 0.75em;"
                                                ><t
                                                        t-esc="getProduct(lineId).lst_price"
                                                    /> JOD</span>
                                            </div>
                                            <div
                                                class="bg-white rounded-circle p-1 d-flex align-items-center justify-content-center text-danger"
                                                style="width: 20px; height: 20px;"
                                            >
                                                <t
                                                    t-if="lineId_first"
                                                >1</t>
                                                <i class="fa fa-times" />
                                            </div>
                                        </button>
                                    </t>
                                </div>
                                <div class="mt-2 text-end">
                                    <button
                                        type="button"
                                        class="btn btn-sm btn-secondary shadow-sm"
                                        t-on-click="() => this.save(true)"
                                        title="Save and create another slot"
                                    >
                                        <i class="fa fa-plus-circle me-1" /> Save &amp; Add Another
                                    </button>
                                </div>

                            </div>

                            <!-- Product List Grid -->
                            <div class="mt-4">
                                <div class="row g-2" style="max-height: 250px; overflow-y: auto;">
                                    <div class="col-12">
                                        <label
                                            class="form-label small fw-bold text-muted text-uppercase mb-2"
                                        ><i
                                                class="fa fa-th-large me-2"
                                            /> Available Services</label>
                                        <select
                                            class="form-select border-0 bg-light shadow-sm mb-2 d-md-none"
                                            t-on-change="(ev) => this.selectProduct(getProduct(ev.target.value))"
                                        >
                                            <option value="">Select Service...</option>
                                            <t
                                                t-foreach="filteredProducts"
                                                t-as="product"
                                                t-key="product.id"
                                            >
                                                <option
                                                    t-att-value="product.id"
                                                >
                                                    <t
                                                        t-esc="product.display_name"
                                                    /> (<t
                                                        t-esc="product.lst_price"
                                                    />)
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                    <!-- Desktop Grid -->
                                    <div
                                        class="col-md-4 col-sm-6 d-none d-md-block"
                                        t-foreach="filteredProducts"
                                        t-as="product"
                                        t-key="product.id"
                                    >
                                        <div
                                            class="card h-100 shadow-sm border-0 product-card cursor-pointer"
                                            t-on-click="() => this.selectProduct(product)"
                                            style="transition: all 0.2s;"
                                        >
                                            <div
                                                class="card-body p-2 d-flex flex-column justify-content-center text-center"
                                            >
                                                <label
                                                    class="form-check-label stretched-link fw-bold text-dark mb-1 text-truncate"
                                                >
                                                    <i
                                                        class="fa fa-scissors text-primary me-1"
                                                    />
                                                    <t
                                                        t-esc="product.display_name"
                                                    />
                                                </label>
                                                <small
                                                    class="text-muted fw-bold"
                                                ><t
                                                        t-esc="product.lst_price"
                                                    /> JOD</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Actions -->
            <t t-set-slot="footer">
                <div class="d-flex justify-content-between w-100 align-items-center">
                    <!-- Note Field -->
                    <div class="flex-grow-1 me-3">
                        <input
                            type="text"
                            class="form-control bg-light border-0"
                            placeholder="Add a note (e.g. Prefer short hair)..."
                            t-model="state.note"
                        />
                    </div>
                    <div class="d-flex gap-2">
                        <button
                            type="button"
                            class="btn btn-light border fw-bold px-4"
                            t-on-click="() => this.cancel()"
                        >Cancel</button>
                        <button
                            type="button"
                            class="btn btn-primary fw-bold px-4 shadow-sm"
                            t-on-click="() => this.save()"
                        >
                            <i class="fa fa-check me-2" /> Save Booking
                        </button>
                    </div>
                </div>
            </t>
        </Dialog>
    </t>
</templates>
